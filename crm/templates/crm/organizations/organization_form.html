{% extends 'crm/base.html' %}
{% load crispy_forms_tags %}

{% block title %}
    {% if organization %}Edytuj organizację{% else %}Nowa organizacja{% endif %} | System Helpdesk
{% endblock %}

{% block extra_css %}
<style>
    .members-container input[type="checkbox"] {
        margin-right: 8px;
    }
    .members-container label {
        display: block;
        padding: 5px 0;
        margin: 0;
    }
    .members-container li {
        list-style: none;
    }
    .members-container ul {
        padding-left: 0;
        margin: 0;
    }
    
    /* Light mode default styles */
    .members-container {
        background-color: #f8f9fa;
        border: 1px solid #ced4da;
    }
    
    /* Dark mode styles for members container */
    [data-theme="dark"] .members-container {
        background-color: var(--input-bg) !important;
        border-color: var(--input-border) !important;
    }
    
    [data-theme="dark"] .members-container label {
        color: var(--text-color) !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-{% if organization %}edit{% else %}plus{% endif %}"></i> 
                {% if organization %}Edytuj organizację{% else %}Nowa organizacja{% endif %}
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    {# Basic organization fields #}
                    {% for field in form %}
                        {% if field.name != 'members' %}
                            {{ field|as_crispy_field }}
                        {% endif %}
                    {% endfor %}
                    
                    {# Members field with scrollable container #}
                    <div class="form-group mt-4">
                        <label class="form-label"><strong>{{ form.members.label }}</strong></label>
                        {% if form.members.help_text %}
                            <small class="form-text text-muted d-block mb-2">{{ form.members.help_text }}</small>
                        {% endif %}
                        <div class="members-container" style="max-height: 300px; overflow-y: auto; border-radius: 0.25rem; padding: 15px;">
                            {{ form.members }}
                        </div>
                        {% if form.members.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.members.errors }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Zapisz
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="goBack()">
                            <i class="fas fa-times"></i> Anuluj
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function goBack() {
        window.history.back();
    }
</script>
{% endblock %}
